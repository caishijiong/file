# 数据库命令

## 创建数据库

```sql
create database `库名`
```

如果进行重复的创建就会失败，不允许重复创建，避免这个问题 `if not exists`

```sql
create database if not exists `库名`
```

添加字符集`utf-8`

```sql
create database `库名` default character set = 'utf8mb4';
```

## 数据表

### 创建表

```sql
CREATE TABLE `user` (
   id int NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT '序号',
   name varchar(100) COMMENT '名字',
   age int COMMENT '年龄',
   address varchar(255) COMMENT '地址',
   create_time timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间'
) COMMENT '用户表'
```

解析

create table 表名字 (

1. `id`字段名称   `int`数据类型代表数字类型   `NOT NULL`(不能为空)  `AUTO_INCREMENT`(id自增) `PRIMARY KEY`(id为主键)
2. `name`(字段名称) `varchar(100)`字符串类型100字符 `COMMENT`(注释)
3. `age`(字段名称) `int`数据类型代表数字类型  `COMMENT`(注释)
4. `create_time`(字段名称) `timestamp`(时间戳) `DEFAULT CURRENT_TIMESTAMP`(自动填充创建时间)

)

#### 修改表名

```sql
ALTER TABLE `user` RENAME `user2`;
```

#### 增加列

```sql
ALTER TABLE `user` Add COLUMN `hobby` VARCHAR(200) COMMENT '爱好';
```

解析：`hobby`(字段名称)  `varchar(200)`字符串类型200字符 `COMMENT`(注释)

#### 删除列

```sql
ALTER TABLE `user` DROP COLUMN `hobby`;
```

#### 编辑列

```sql
ALTER TABLE `user` MODIFY COLUMN `age` VARCHAR(255) NULL COMMENT '年龄2';
```

解析：`age`(字段名称)  `varchar(255)` 将字符串类型100字符修改为字符串类型255字符并修改`COMMENT`(注释)

### 查询

#### 查询单个列

```sql
SELECT `name` FROM `user`;
```

#### 查询多个列，逗号隔开即可

```sql
SELECT `name`,`id` FROM `user`;
```

#### 查询所有列 *

```sql
SELECT *  FROM `user`;
```

#### 列的别名 `as`

```sql
SELECT `name` as `user_name`,`id` as `user_id` FROM `user`;
```

#### 排序

ORDER BY [字段名称] `desc`降序(从大到小) `asc` 升序(从小到大)

```sql
SELECT *  FROM `user` ORDER BY id DESC;
```

#### 限制查询结果

limit [开始行] [限制条数] 用于分页

> 使用limit的时候是从0开始的跟数组一样

```sql
SELECT * FROM `user` LIMIT 0,3
```

#### 条件查询

我们需要把`搜索条件`放在`WHERE`子句中 例如查询name字段所对应的值 小满

> 完全匹配

```sql
SELECT *  FROM `user` WHERE name = "坤坤";
```

#### 多个条件查询

比如说 我想查询 name 叫 鸡哥的，并且年龄是20岁以下的

- and 操作符

在给定多个搜索条件的时候，我们有时需要某条记录只在符合所有搜索条件的时候进行查询，这种情况我们可以使用`and`操作符来连接多个搜索条件

```sql
SELECT * FROM `user` WHERE name = '鸡哥' AND age <= 20;
```

- or 操作符

在给定多个搜索条件的时候，我们有时需要某条记录在符合某一个搜索条件的时候就将其加入结果集中，这种情况我们可以使用`OR`操作符来连接多个搜索条件

> 只需满足一个条件就可以

```sql
SELECT * FROM `user` WHERE name = '鸡哥' OR age <= 20;
```

#### 模糊查询

在MySQL中，"LIKE"操作符用于模糊匹配字符串。而百分号（%）是用作通配符，表示任意字符（包括零个字符或多个字符）的占位符。

当你在使用"LIKE"操作符时，可以在模式（pattern）中使用百分号来匹配一个或多个字符。下面是一些使用百分号的示例：

- "鸡%"：匹配以"满"开头的字符串，后面可以是任意字符。
- "%鸡"：匹配以"满"结尾的字符串，前面可以是任意字符。
- "%鸡%"：匹配包含"满"的任意位置的字符串，前后可以是任意字符。

```sql
SELECT * FROM `user` WHERE name LIKE '%鸡%';
```

### 增删改

#### 新增

在这个语句中，我们明确了插入的顺序，第一个字段对应name，第二个字段对应age，第三个address，第四个create_time，values里面的值是与之对应的

```sql
INSERT INTO user(`name`,`age`,`address`,`create_time`) VALUES('代号玖',20, '玄武国','2025-10-22 09:19:00')
```

插入null值

在设计表结构的时候，我们允许 name age hobby 为null，所以我们也可以插入null值

```sql
INSERT INTO user(`name`,`hobby`,`age`) VALUES(NULL,NULL,NULL)
```

插入多条数据 逗号隔开即可

```sql
INSERT INTO user(`name`,`hobby`,`age`) VALUES(NULL,NULL,NULL),('代号玖','磨刀',20),('五六柒','箭头',20)
```

#### 删除

删除id为8的记录

```sql
DELETE FROM `user` WHERE id = 8; 
```

批量删除

```sql
DELETE FROM `user` WHERE id IN (8,9,10);
```

#### 修改

更新的字段使用=赋值, where确定更新的条例

```sql
UPDATE `user` SET name='元大鹰', age=20, hobby='篮球' WHERE id = 17;
```

批量更新

```sql
INSERT INTO user (`id`, `sex`) VALUES (8, 1), (9, 2), (10, 1) ON DUPLICATE KEY UPDATE sex = VALUES(sex);
```

使用 `CASE` 语句批量更新

```sql
UPDATE user 
SET sex = CASE 
    WHEN id = 8 THEN 1
    WHEN id = 9 THEN 2
    WHEN id = 10 THEN 1
    ELSE sex
END
WHERE id IN (8, 9, 10);
```

### 表达式和函数

#### 表达式

MySQL表达式是一种在MySQL数据库中使用的计算式或逻辑式。它们可用于查询、更新和过滤数据，以及进行条件判断和计算。

1. 算术表达式：可以执行基本的数学运算，例如加法、减法、乘法和除法。例如：`SELECT col1 + col2 AS sum FROM table_name;`
2. 字符串表达式：可以对字符串进行操作，例如连接、截取和替换。例如：`SELECT CONCAT(first_name, ' ', last_name) AS full_name FROM table_name;`
3. 逻辑表达式：用于执行条件判断，返回布尔值（TRUE或FALSE）。例如：`SELECT * FROM table_name WHERE age > 18 AND gender = 'Male';`
4. 条件表达式：用于根据条件返回不同的结果。例如：`SELECT CASE WHEN age < 18 THEN 'Minor' ELSE 'Adult' END AS age_group FROM table_name;`
5. 聚合函数表达式：用于计算数据集的聚合值，例如求和、平均值、最大值和最小值。例如：`SELECT AVG(salary) AS average_salary FROM table_name;`
6. 时间和日期表达式：用于处理时间和日期数据，例如提取年份、月份或计算日期差值。例如：`SELECT YEAR(date_column) AS year FROM table_name;`

例如查询的时候增加数值100

```sql
SELECT age + 100 FROM `user`;
```

如果要换一个列名可以用as

```sql
SELECT age + 100 as age FROM `user`;
```

#### 函数

MySQL提供了大量的内置函数，用于在查询和操作数据时进行计算、转换和处理。以下是一些常用的MySQL函数分类及其示例：

1. 字符串函数：
   - `CONCAT(str1, str2, ...)`：将多个字符串连接起来。
   
   ```sql
   SELECT CONCAT(name, '123') FROM `user`;
   ```
   
   - `SUBSTRING(str, start, length)`：从字符串中提取子字符串。
   
   ```sql
   SELECT SUBSTRING(create_time, 1, 10) FROM `user`;
   ```
   
   - `UPPER(str)`：将字符串转换为大写。
   
   ```sql
   SELECT UPPER(name) as name FROM `user`;
   ```
   
   - `LOWER(str)`：将字符串转换为小写。
   
   ```sql
   SELECT LOWER(name) as name FROM `user`;
   ```
   
   - `LENGTH(str)`：返回字符串的长度。
   
   ```sql
   SELECT LENGTH(name) as name FROM `user`;
   ```
   
2. 数值函数：
   - `ABS(x)`：返回x的绝对值。
   - `ROUND(x, d)`：将x四舍五入为d位小数。
   - `CEILING(x)`：返回不小于x的最小整数。
   - `FLOOR(x)`：返回不大于x的最大整数。
   - `RAND()`：返回一个随机数。
   
   ```sql
   SELECT RAND() FROM `user`;
   ```
   
3. 日期和时间函数：
   - `NOW()`：返回当前日期和时间。
   - `CURDATE()`：返回当前日期。
   - `CURTIME()`：返回当前时间。
   - `DATE_FORMAT(date, format)`：将日期格式化为指定的格式。
   - `DATEDIFF(date1, date2)`：计算两个日期之间的天数差。
   
4. 条件函数：
   - `IF(condition, value_if_true, value_if_false)`：根据条件返回不同的值。
   
   ```sql
   SELECT IF(sex = 1 ,'男','女') as sex FROM `user`;
   ```
   
   - `CASE WHEN condition1 THEN result1 WHEN condition2 THEN result2 ELSE result END`：根据条件返回不同的结果。
   
5. 聚合函数：
   - `COUNT(expr)`：计算满足条件的行数。
   
   ```sql
   SELECT COUNT(*) FROM `user`;
   ```
   
   - `SUM(expr)`：计算表达式的总和。
   
   ```sql
   SELECT SUM(`age`) FROM `user`;
   ```
   
   - `AVG(expr)`：计算表达式的平均值。
   
   ```sql
   SELECT AVG(`age`) FROM `user`;
   ```
   
   - `MAX(expr)`：返回表达式的最大值。
   
   ```sql
   SELECT MAX(`age`) FROM `user`;
   ```
   
   - `MIN(expr)`：返回表达式的最小值。
   
   ```sql
   SELECT MIN(`age`) FROM `user`;
   ```

### 子查询和连表

#### 子查询

子查询（Subquery），也被称为嵌套查询（Nested Query），是指在一个查询语句中嵌套使用另一个完整的查询语句。子查询可以被视为一个查询的结果集，它可以作为外层查询的一部分，用于进一步筛选、计算或操作数据。

子查询通常出现在主查询的WHERE子句、FROM子句、HAVING子句或SELECT子句中，以提供更复杂的查询逻辑。子查询可以根据主查询的结果动态生成结果集，用于过滤和匹配数据，或者作为函数的参数使用。

子查询可以返回单个值、一列值、一行值或者一个结果集，具体取决于子查询的语法和用法。根据子查询返回的结果类型，可以将其与主查询的其他表达式进行比较、连接或使用作为条件进行过滤。

我们之前的案例都是在一张表去查询，现实中不会把所有东西都放在一张表，会进行分表，甚至还会分库分表，读写分离等等。

------

$\textcolor{RedOrange}{关联关系为user表的id 关联 photo表的user\_id}$

但是我们现在需要通过名字查询出photo表的数据 但是photo表没有存名字怎么弄

$\textcolor{RedOrange}{子查询}$

我们的思路就是通过名字查询user表的id，然后通过user表的id去查询photo的user_id就完成了

```sql
SELECT * FROM `photo` WHERE `user_id` = (SELECT id FROM `user` WHERE name = '鸡哥')
```

### 连表

Mysql的连表分为内连接，外连接，交叉连接

1. 对于 `内连接` 的两个表，驱动表中的记录在被驱动表中找不到匹配的记录，该记录不会加入到最后的结果集，我们上边提到的连接都是所谓的 `内连接`。
2. 对于 `外连接` 的两个表，驱动表中的记录即使在被驱动表中没有匹配的记录，也仍然需要加入到结果集。
3.  `交叉连接` 是指在两张或多张表之间没有任何连接条件的连接。简单来说，`交叉连接` 可以让你查询所有可能的组合。

#### 内连接

```sql
SELECT * FROM `user`, `photo` WHERE `user`.`id` = `photo`.`user_id`
```

#### 外连接

$\textcolor{RedOrange}{左连接}$

语法规则 LEFT JOIN [连接的表] ON [连接的条件]

并且以第一个表作为 $\textcolor{RedOrange}{驱动表}$ 被驱动表如果没有值则补充null

```sql
SELECT * FROM `user` LEFT JOIN `table` ON `user`.`id` = `table`.`user_id`
```

$\textcolor{RedOrange}{右连接}$

语法规则 RIGHT JOIN [连接的表] ON [连接的条件]

并且以第二个表作为 $\textcolor{RedOrange}{驱动表}$ 被驱动表如果没有值则忽略

```sql
SELECT * FROM `user` RIGHT JOIN `table` ON `user`.`id` = `table`.`user_id`
```

